{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.EStreamParserEvent = void 0;\n\nconst events_1 = require(\"events\");\n\nclass TweetStreamParser extends events_1.EventEmitter {\n  constructor() {\n    super(...arguments);\n    this.currentMessage = '';\n  } // Code partially belongs to twitter-stream-api for this\n  // https://github.com/trygve-lie/twitter-stream-api/blob/master/lib/parser.js\n\n\n  push(chunk) {\n    this.currentMessage += chunk;\n    chunk = this.currentMessage;\n    const size = chunk.length;\n    let start = 0;\n    let offset = 0;\n\n    while (offset < size) {\n      // Take [offset, offset+1] inside a new string\n      if (chunk.slice(offset, offset + 2) === '\\r\\n') {\n        // If chunk contains \\r\\n after current offset,\n        // parse [start, ..., offset] as a tweet\n        const piece = chunk.slice(start, offset);\n        start = offset += 2; // If empty object\n\n        if (!piece.length) {\n          continue;\n        }\n\n        try {\n          const payload = JSON.parse(piece);\n\n          if (payload) {\n            this.emit(EStreamParserEvent.ParsedData, payload);\n            continue;\n          }\n        } catch (error) {\n          this.emit(EStreamParserEvent.ParseError, error);\n        }\n      }\n\n      offset++;\n    }\n\n    this.currentMessage = chunk.slice(start, size);\n  }\n  /** Reset the currently stored message (f.e. on connection reset) */\n\n\n  reset() {\n    this.currentMessage = '';\n  }\n\n}\n\nexports.default = TweetStreamParser;\nvar EStreamParserEvent;\n\n(function (EStreamParserEvent) {\n  EStreamParserEvent[\"ParsedData\"] = \"parsed data\";\n  EStreamParserEvent[\"ParseError\"] = \"parse error\";\n})(EStreamParserEvent = exports.EStreamParserEvent || (exports.EStreamParserEvent = {}));","map":{"version":3,"sources":["/Users/tarungunampalli/Documents/twitter-oauth/node_modules/twitter-api-v2/dist/stream/TweetStreamParser.js"],"names":["Object","defineProperty","exports","value","EStreamParserEvent","events_1","require","TweetStreamParser","EventEmitter","constructor","arguments","currentMessage","push","chunk","size","length","start","offset","slice","piece","payload","JSON","parse","emit","ParsedData","error","ParseError","reset","default"],"mappings":"AAAA;;AACAA,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AAAEC,EAAAA,KAAK,EAAE;AAAT,CAA7C;AACAD,OAAO,CAACE,kBAAR,GAA6B,KAAK,CAAlC;;AACA,MAAMC,QAAQ,GAAGC,OAAO,CAAC,QAAD,CAAxB;;AACA,MAAMC,iBAAN,SAAgCF,QAAQ,CAACG,YAAzC,CAAsD;AAClDC,EAAAA,WAAW,GAAG;AACV,UAAM,GAAGC,SAAT;AACA,SAAKC,cAAL,GAAsB,EAAtB;AACH,GAJiD,CAKlD;AACA;;;AACAC,EAAAA,IAAI,CAACC,KAAD,EAAQ;AACR,SAAKF,cAAL,IAAuBE,KAAvB;AACAA,IAAAA,KAAK,GAAG,KAAKF,cAAb;AACA,UAAMG,IAAI,GAAGD,KAAK,CAACE,MAAnB;AACA,QAAIC,KAAK,GAAG,CAAZ;AACA,QAAIC,MAAM,GAAG,CAAb;;AACA,WAAOA,MAAM,GAAGH,IAAhB,EAAsB;AAClB;AACA,UAAID,KAAK,CAACK,KAAN,CAAYD,MAAZ,EAAoBA,MAAM,GAAG,CAA7B,MAAoC,MAAxC,EAAgD;AAC5C;AACA;AACA,cAAME,KAAK,GAAGN,KAAK,CAACK,KAAN,CAAYF,KAAZ,EAAmBC,MAAnB,CAAd;AACAD,QAAAA,KAAK,GAAGC,MAAM,IAAI,CAAlB,CAJ4C,CAK5C;;AACA,YAAI,CAACE,KAAK,CAACJ,MAAX,EAAmB;AACf;AACH;;AACD,YAAI;AACA,gBAAMK,OAAO,GAAGC,IAAI,CAACC,KAAL,CAAWH,KAAX,CAAhB;;AACA,cAAIC,OAAJ,EAAa;AACT,iBAAKG,IAAL,CAAUnB,kBAAkB,CAACoB,UAA7B,EAAyCJ,OAAzC;AACA;AACH;AACJ,SAND,CAOA,OAAOK,KAAP,EAAc;AACV,eAAKF,IAAL,CAAUnB,kBAAkB,CAACsB,UAA7B,EAAyCD,KAAzC;AACH;AACJ;;AACDR,MAAAA,MAAM;AACT;;AACD,SAAKN,cAAL,GAAsBE,KAAK,CAACK,KAAN,CAAYF,KAAZ,EAAmBF,IAAnB,CAAtB;AACH;AACD;;;AACAa,EAAAA,KAAK,GAAG;AACJ,SAAKhB,cAAL,GAAsB,EAAtB;AACH;;AA1CiD;;AA4CtDT,OAAO,CAAC0B,OAAR,GAAkBrB,iBAAlB;AACA,IAAIH,kBAAJ;;AACA,CAAC,UAAUA,kBAAV,EAA8B;AAC3BA,EAAAA,kBAAkB,CAAC,YAAD,CAAlB,GAAmC,aAAnC;AACAA,EAAAA,kBAAkB,CAAC,YAAD,CAAlB,GAAmC,aAAnC;AACH,CAHD,EAGGA,kBAAkB,GAAGF,OAAO,CAACE,kBAAR,KAA+BF,OAAO,CAACE,kBAAR,GAA6B,EAA5D,CAHxB","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.EStreamParserEvent = void 0;\nconst events_1 = require(\"events\");\nclass TweetStreamParser extends events_1.EventEmitter {\n    constructor() {\n        super(...arguments);\n        this.currentMessage = '';\n    }\n    // Code partially belongs to twitter-stream-api for this\n    // https://github.com/trygve-lie/twitter-stream-api/blob/master/lib/parser.js\n    push(chunk) {\n        this.currentMessage += chunk;\n        chunk = this.currentMessage;\n        const size = chunk.length;\n        let start = 0;\n        let offset = 0;\n        while (offset < size) {\n            // Take [offset, offset+1] inside a new string\n            if (chunk.slice(offset, offset + 2) === '\\r\\n') {\n                // If chunk contains \\r\\n after current offset,\n                // parse [start, ..., offset] as a tweet\n                const piece = chunk.slice(start, offset);\n                start = offset += 2;\n                // If empty object\n                if (!piece.length) {\n                    continue;\n                }\n                try {\n                    const payload = JSON.parse(piece);\n                    if (payload) {\n                        this.emit(EStreamParserEvent.ParsedData, payload);\n                        continue;\n                    }\n                }\n                catch (error) {\n                    this.emit(EStreamParserEvent.ParseError, error);\n                }\n            }\n            offset++;\n        }\n        this.currentMessage = chunk.slice(start, size);\n    }\n    /** Reset the currently stored message (f.e. on connection reset) */\n    reset() {\n        this.currentMessage = '';\n    }\n}\nexports.default = TweetStreamParser;\nvar EStreamParserEvent;\n(function (EStreamParserEvent) {\n    EStreamParserEvent[\"ParsedData\"] = \"parsed data\";\n    EStreamParserEvent[\"ParseError\"] = \"parse error\";\n})(EStreamParserEvent = exports.EStreamParserEvent || (exports.EStreamParserEvent = {}));\n"]},"metadata":{},"sourceType":"script"}